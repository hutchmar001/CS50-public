{% extends "layout.html" %}

{% block title %}
    Bible Results
{% endblock %}

{% block main %}
<body id="bible">

<div class="pagination">
    <a href="#">&laquo;</a>
    <a href="#">1</a>
    <a class="active" href="#">2</a>
    <a href="#">3</a>
    <a href="#">4</a>
    <a href="#">5</a>
    <a href="#">6</a>
    <a href="#">&raquo;</a>
    </div>

<select name="books" id="books" style="display:{{ display_select }}" onchange="location = this.value;">
    <option value="">Select...</option>
    <option value= "All">All</option>
    {% for i in result %}
        <option value= {{i}}>{{i}}</option>
    {% endfor %}
</select>
<br><br><br>

<table action="/Bible" method="get" class="table table-hover">

    <button onclick="inc(id)" style="background: crimson; display:{{ display_highlight }}">Highlight</button>
    <tbody>
        <h1>Bible</h1>
        <tr>
            <th>Number</th>
            <th>Book</th>
            <th>Chapter</th>
            <th>Verse</th>
            <th>Text</th>
        </tr>
        {% for i in lst %}
        <tr>
            <td>
                <p>{{i.number}}</p>
            </td>
            <td>
                <p><b>{{i.book_name}}</b></p>
            </td>
            <td>
                <p>{{i.chapter}}</p>
            </td>
            <td>
                <p>{{i.verse}}</p>
            </td>
            <td>
                <p>{{i.text}}</p>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</body>

<script>
    var search_upper = {{search_upper|tojson}};
    var search_lower = {{search_lower|tojson}};
    // Works great for passing Flask value to Javascript

    function highlight() {
        document.body.innerHTML = document.body.innerHTML.replace (new RegExp (search_upper, 'g'), "<mark>{{search_upper}}</mark>");
        document.body.innerHTML = document.body.innerHTML.replace (new RegExp (search_lower, 'g'), "<mark>{{search_lower}}</mark>");
    }

    function dehighlight() {
        document.body.innerHTML = document.body.innerHTML.replace (new RegExp (search_upper, 'g'), "<p>{{search_upper}}</p>");
        document.body.innerHTML = document.body.innerHTML.replace (new RegExp (search_lower, 'g'), "<p>{{search_lower}}</p>");

        const matches = document.querySelectorAll("mark");
        matches.forEach(mark => {
        mark.remove();
        });
        // Removes all <mark> tags
    }

    var count = 0;

    function inc(){
    count ++;
    if (count % 2 == 0) {
        dehighlight();
    } else {
        highlight();
    }
};

const table = document.querySelector('table');
const rowsPerPage = 5;
let currentPage = 1;
const totalPages = Math.ceil(totalRows / rowsPerPage);

function showPage(page) {
  const start = (page - 1) * rowsPerPage;
  const end = start + rowsPerPage;
  for (let i = 0; i < totalRows; i++) {
    if (i < start || i >= end) {
        table.tBodies[0].rows[i].classList.add('hide');
    } else {
      table.tBodies[0].rows[i].classList.remove('hide');
    }
  }

const pagination = document.createElement('ul');
for (let i = 1; i <= totalPages; i++) {
  const li = document.createElement('li');
  const a = document.createElement('a');
  a.textContent = i;
  a.href = '#';
  li.appendChild(a);
  pagination.appendChild(li);
}

table.parentNode.insertBefore(pagination, table.nextSibling);
showPage(currentPage);

const pageLinks = document.querySelectorAll('.pagination li');
  for (let i = 0; i < totalPages; i++) {
    if (i === page - 1) {
      pageLinks[i].classList.add('active');
    } else {
      pageLinks[i].classList.remove('active');
    }
  }
}

const pagination = document.createElement('ul');
pagination.classList.add('pagination');

</script>
{% endblock %}